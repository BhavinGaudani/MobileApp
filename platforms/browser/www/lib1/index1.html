<!DOCTYPE html>

<html lang="en" ng-app="app">

    <head>
        <meta charset="utf-8" />
        <!-- JS dependencies (order matters!) -->
		<script src="lib/js/onsenui.js"></script>
        <script src="lib/js/angular/angular.js"></script>
		<script src="lib/js/angular-onsenui.js"></script>
        
        <!-- CSS dependencies -->
        <link rel="stylesheet" href="lib/css/onsenui.css" />
        <link rel="stylesheet" href="lib/css/onsen-css-components.css" />
        <link rel="stylesheet" href="css/login.css">
        <link rel="stylesheet" href="css/signup.css">
        <link rel="stylesheet" href="css/schedule.css">
        <link rel="stylesheet" href="css/timeline.css">
		
        <!-- CSP support mode (required for Windows Universal apps) -->
        <link rel="stylesheet" href="lib/js/angular/angular-csp.css" />
		
        <title>CSE</title>
        <script>
            var myApp = angular.module('app', ['onsen'])
            myApp.factory('dataFactory', ['$http', function($http) {

                var urlBase = 'http://rajeshnandwani-001-site6.htempurl.com/api/cse';
                var dataFactory = {};

                dataFactory.chekUser = function(userName) {
                    return $http.get(urlBase + '?UserName=' + userName);
                };

                dataFactory.getVisit = function(id) {
                    return $http.get('http://rajeshnandwani-001-site6.htempurl.com/api/visit' + '?CSEId=' + id);
                };
				
				dataFactory.getVisitDetail = function(id) {
                    return $http.get('http://rajeshnandwani-001-site6.htempurl.com/api/visit' + '/' + id);
                };

                dataFactory.insertUser = function(cust) {
                    return $http.post(urlBase, cust);
                };

                dataFactory.updateVisit = function(cust) {
                    return $http.put('http://rajeshnandwani-001-site6.htempurl.com/api/visit' + '/' + cust.Id, cust)
                };

                return dataFactory;
            }]);

            myApp.controller('checkUserController', ['$scope', 'dataFactory',
                function($scope, dataFactory) {
                    $scope.chekUser = function(userName) {
                        if ($scope.userName == null || $scope.userName == "") {
                            ons.notification.alert({
                                title: 'User',
                                message: 'Enter UserName!'
                            });
                        } else if ($scope.password == null || $scope.password == "") {
                            ons.notification.alert({
                                title: 'User',
                                message: 'Enter Password!'
                            });
                        } else {	
						    modalUpload.show()
                            dataFactory.chekUser(userName)
                                .then(function(response) {
                                    $scope.status = 'Retrieved orders!';
                                    $scope.users = response.data;
                                    if ($scope.users.length > 0) {
                                        if ($scope.userName == $scope.users[0].UserName && $scope.password == $scope.users[0].Password) {
                                            dataFactory.getVisit($scope.users[0].Id)
                                                .then(function(response) {
                                                    $scope.status = 'Retrieved orders!';
                                                    var selectedUser = response.data;
                                                    dataFactory.selectedUser = selectedUser;
													modalUpload.hide()
                                                    $scope.app.navi.pushPage('mainpage.html');
                                                }, function(error) {
                                                    $scope.status = 'Error retrieving users! ' + error.message;
													modalUpload.hide()
                                                });
                                        } else {
										    modalUpload.hide()
                                            ons.notification.alert({
                                                title: 'User',
                                                message: 'User Not Valid!'
                                            });
                                        }
                                    } else {
									    modalUpload.hide()
                                        ons.notification.alert({
                                            title: 'User',
                                            message: 'User Not Valid!'
                                        });
                                    }

                                }, function(error) {
                                    $scope.status = 'Error retrieving users! ' + error.message;
									modalUpload.hide()
                                });
                        };
                    }
                }
            ]);
            myApp.controller('visitController', function($scope, dataFactory) {		
			
                $scope.users = dataFactory.selectedUser;
                				
                $scope.getVisitDetail= function(id) {
				    modalUpload.show()
                    dataFactory.getVisitDetail(id)
                        .then(function(response) {
                            $scope.status = 'Retrieved orders!';
                            var selectedItem = response.data;
                            dataFactory.selectedItem = selectedItem;
							modalUpload.hide()
                            $scope.app.navi.pushPage('visit.html');
                        }, function(error) {
                            $scope.status = 'Error retrieving users! ' + error.message;
							modalUpload.hide()
                        });
                };

            });
            myApp.controller('usersController', ['$scope', 'dataFactory',
                function($scope, dataFactory) {

                    $scope.status;
                    $scope.users;

                    $scope.insertUser = function() {
                            dataFactory.insertUser($scope.user)
                                .then(function(response) {
                                    $scope.status = 'Inserted user! Refreshing user list.';
                                    ons.notification.alert({
                                        title: 'User',
                                        message: 'User created successfully!',
                                        callback: function(answer) {
                                            $scope.app.navi.popPage('login.html');
                                        }
                                    });
                                    $scope.users.push(user);
                                }, function(error) {
                                    $scope.status = 'Unable to insert user: ' + error.message;
                                });
                            $scope.users = null;
                    };

                }
            ]);

            myApp.controller('visitdetailsController', function($scope, dataFactory) {
                $scope.user = dataFactory.selectedItem;

                $scope.updateVisit = function(user) {
				    modalUpload.show()
                    dataFactory.updateVisit(user)
                        .then(function(response) {
                            $scope.status = 'Updated user! Refreshing user list.';
							modalUpload.hide()
                            ons.notification.alert({
                                title: 'User',
                                message: 'User updated successfully!',
                                callback: function(answer) {
                                    $scope.app.navi.pushPage('visit.html');
                                }
                            });
                        }, function(error) {
                            $scope.status = 'Unable to update user: ' + error.message;
							modalUpload.hide()
                        });
                };

            });
        </script>
    </head>

    <body>
        <!-- Cordova reference -->
        <script src="cordova.js"></script>
        <ons-modal var="modalUpload"><ons-progress type="circular" indeterminate></ons-progress></ons-modal>						
        <ons-navigator var="app.navi">
            <ons-page>
                <div ng-controller="checkUserController">
                    <ons-toolbar>
                        <div class="center">Log In</div>
                    </ons-toolbar>
                    <div class="login-form">
                        <input type="text" class="text-input--underbar width-full" placeholder="UserName" ng-model="userName">
                        <input type="password" class="text-input--underbar" placeholder="Password" ng-model="password">
                        <br><br>
                        <ons-button modifier="large" class="login-button" ng-click="chekUser(userName)">Log In</ons-button>
                        <br><br>
                        <ons-button modifier="quiet" class="forgot-password" ng-click="app.navi.pushPage('signup.html');">Sign Up?</ons-button>
                    </div>
                </div>
            </ons-page>
        </ons-navigator>
        <ons-template id="mainpage.html">		
            <ons-page>
			 <div ng-controller="visitController">
                    <ons-toolbar>
                        <div class="left">
                            <div class="center">Schedule</div>
                        </div>
                        <div class="right">
                            <ons-back-button>LogOut</ons-back-button>
                        </div>
                    </ons-toolbar>
                    <ons-list-header>
                        {{user.PartyName}}
                    </ons-list-header>
                    <ons-list class="plan-list">
                        <ons-list-item modifier="chevron" class="plan" ng-repeat="user in users" ng-click="getVisitDetail(user.Id)">
                            <ons-row>
                                <ons-col width="80px" class="plan-left">
                                    <div class="plan-date">{{user.ScheduleTime}}</div>
                                    <!-- <div class="plan-duration">1h</div> -->
                                </ons-col>
                                <ons-col width="6px" class="plan-center" ng-style="{backgroundColor:a % 3 == 1 ? '#3399ff' : '#ccc'}">
                                </ons-col>
                                <ons-col class="plan-right">
                                    <div class="plan-name">{{user.PartyName}}</div>
                                    <div class="plan-info">
                                        <div ng-hide="a % 4 == 0">
                                            <ons-icon icon="fa-phone"></ons-icon>
                                            {{user.PhoneNumber}}
                                        </div>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                    </ons-list>
                </div>
            </ons-page>
        </ons-template>
        <ons-template id="visit.html">
            <ons-page>
                <div ng-controller="visitdetailsController">
                    <ons-toolbar>
                        <div class="left">
                            <ons-toolbar-button>
                                <ons-icon icon="ion-compose" fixed-width="false" style="font-size: 26px; vertical-align: -4px" ng-click="app.navi.pushPage('editvisit.html');"></ons-icon>
                            </ons-toolbar-button>
                        </div>
                        <div class="center">
                            {{user.PartyName}}
                        </div>
                        <div class="right">
                            <ons-back-button>Back</ons-back-button>
                        </div>
                    </ons-toolbar>
                    <ons-list class="timeline" modifier="inset">
                        <ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">PartyCode</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.PartyCode}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                        <ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">PhoneNumber</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.PhoneNumber}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                        <ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Address</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.Address}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Other Address</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.OtherAddress}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Caller Name</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.CallerName}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Caller Number</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.CallerNumber}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Schedule Time</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.ScheduleTime}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Complaint</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.Complaint}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Action</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.Action}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">InTime</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.InTime}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">OutTime</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.OutTime}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li" modifier="tappable">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">isSolved</div>
                                    <div class="timline-from">
                                        <span class="timeline-name">{{user.isSolved}}</span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                    </ons-list>
                </div>
            </ons-page>
        </ons-template>
        <ons-template id="editvisit.html">
            <ons-page>
                <div ng-controller="visitdetailsController">
                    <ons-toolbar>
                        <div class="left">
                            <ons-toolbar-button>
                                <ons-button ng-click="app.navi.pushPage('mainpage.html');">Cancel</ons-button>
                            </ons-toolbar-button>
                        </div>
                        <div class="center">
                            {{user.UserName}}
                        </div>
                        <div class="right">
                            <ons-toolbar-button>
                                <ons-button ng-click="updateVisit(user)">Save</ons-button>
                            </ons-toolbar-button>
                        </div>
                    </ons-toolbar>
                    <ons-list class="timeline" modifier="inset">
                        <ons-list-item class="timeline-li">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Complaint</div>
                                    <div class="timline-from">
                                        <span class="timeline-name"><input type="text" class="text-input" style="width:100%; margin-top:4px;" ng-model="user.Complaint"></span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                        <ons-list-item class="timeline-li">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Action</div>
                                    <div class="timline-from">
                                        <span class="timeline-name"><input type="text" class="text-input" style="width:100%; margin-top:4px;" ng-model="user.Action"></span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
						<ons-list-item class="timeline-li">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">InTime</div>
                                    <div class="timline-from">
                                        <span class="timeline-name"><input type="text" class="text-input" style="width:100%; margin-top:4px;" ng-model="user.InTime"></span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                        <ons-list-item class="timeline-li">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">OutTime</div>
                                    <div class="timline-from">
                                        <span class="timeline-name"><input type="text" class="text-input" style="width:100%; margin-top:4px;" ng-model="user.OutTime"></span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item><ons-list-item class="timeline-li">
                            <ons-row>
                                <ons-col>
                                    <div class="timeline-date">Solve?</div>
                                    <div class="timline-from">
                                        <span class="timeline-name"><input type="text" class="text-input" style="width:100%; margin-top:4px;" ng-model="user.isSolved"></span>
                                    </div>
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                    </ons-list>
                </div>
            </ons-page>
        </ons-template>
        <ons-template id="signup.html">
            <ons-page>
                <div ng-controller="usersController">
                    <ons-toolbar>
                        <div class="left">
                            <ons-back-button>Back</ons-back-button>
                        </div>
                        <div class="center">Sign up</div>
                    </ons-toolbar>
                    <div class="formarea">
                        <div class="form-row">
                            <input type="text" class="text-input--underbar width-full" placeholder="UserName" ng-model="user.UserName" value="">
                        </div>
                        <div class="form-row">
                            <input type="text" class="text-input--underbar width-full" placeholder="Mobile Number" ng-model="user.PhoneNumber" value="">
                        </div>
                        <div class="form-row">
                            <input type="password" class="text-input--underbar width-full" placeholder="Password" ng-model="user.Password" value="">
                        </div>
                        <div class="vspc form-row">
                            <ons-button modifier="large" class="login-button" ng-click="insertUser()">Sign Up</ons-button>
                        </div>
                    </div>
                    <div>
            </ons-page>
        </ons-template>
    </body>

</html>